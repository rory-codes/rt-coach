{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="container mt-5">
    <div class="row">
        <div class="col-4 text-center">
            <img src="{% static 'images/nobody.jpg' %}" width="75%" />
        </div>
        <div class="col-8">
            <h2>{{ fitness_data.title }}</h2>
            {{ fitness_data.content | safe }}
        </div>
    </div>

    <!-- Personal Metrics -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title mb-3">Personal Metrics</h4>
                    <form onsubmit="return false;">
                        <div class="row g-3">
                            <!-- BMI -->
                            <div class="col-md-3">
                                <label for="weightKg" class="form-label">Weight (kg)</label>
                                <input type="number" step="0.1" min="0" class="form-control" id="weightKg"
                                    placeholder="e.g. 72.5">
                            </div>
                            <div class="col-md-3">
                                <label for="heightCm" class="form-label">Height (cm)</label>
                                <input type="number" step="0.1" min="0" class="form-control" id="heightCm"
                                    placeholder="e.g. 175">
                            </div>

                            <!-- Waist / Hip -->
                            <div class="col-md-3">
                                <label for="waistCm" class="form-label">Waist (cm)</label>
                                <input type="number" step="0.1" min="0" class="form-control" id="waistCm"
                                    placeholder="e.g. 82">
                            </div>
                            <div class="col-md-3">
                                <label for="hipCm" class="form-label">Hip (cm)</label>
                                <input type="number" step="0.1" min="0" class="form-control" id="hipCm"
                                    placeholder="e.g. 96">
                            </div>

                            <!-- Age / Resting HR -->
                            <div class="col-md-3">
                                <label for="age" class="form-label">Age (years)</label>
                                <input type="number" min="0" class="form-control" id="age" placeholder="e.g. 34">
                            </div>
                            <div class="col-md-3">
                                <label for="rhr" class="form-label">Resting Heart Rate (bpm)</label>
                                <input type="number" min="0" class="form-control" id="rhr" placeholder="e.g. 60">
                            </div>
                        </div>

                        <div class="mt-3">
                            <button type="button" class="btn btn-primary" id="calcBtn">Calculate</button>
                            <button type="button" class="btn btn-outline-secondary ms-2" id="clearBtn">Clear</button>
                        </div>
                    </form>

                    <hr class="my-4">

                    <div class="row g-4">
                        <div class="col-md-4">
                            <h5 class="mb-2">BMI</h5>
                            <p class="mb-1"><strong id="bmiValue">—</strong></p>
                            <small id="bmiNote" class="text-muted"></small>
                        </div>
                        <div class="col-md-4">
                            <h5 class="mb-2">Waist-to-Hip Ratio</h5>
                            <p class="mb-1"><strong id="whrValue">—</strong></p>
                            <small id="whrNote" class="text-muted"></small>
                        </div>
                        <div class="col-md-4">
                            <h5 class="mb-2">Max HR & HR Reserve</h5>
                            <p class="mb-1">Max HR: <strong id="maxHr">—</strong> bpm</p>
                            <p class="mb-1">HRR: <strong id="hrr">—</strong> bpm</p>
                            <small class="text-muted">Max HR = 220 − age; HRR = Max HR − Resting HR.</small>
                        </div>
                    </div>


                    <div class="table-responsive mt-4">
                        <table class="table table-sm align-middle">
                            <thead>
                                <tr>
                                    <th>Zone</th>
                                    <th>Intensity (% HRR)</th>
                                    <th>Target Range (bpm)</th>
                                </tr>
                            </thead>
                            <tbody id="zonesBody">
                                <tr>
                                    <td colspan="3" class="text-muted">Enter age and resting heart rate to see zones.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /Personal Metrics -->

    <div class="row">
        <div class="col text-right">
            <p class="text-end"><em>Updated on: {{ fitness_data.updated_on }}</em></p>
        </div>
    </div>
</div>

<script>
(function () {
  const $ = (id) => document.getElementById(id);

  function toNum(v) {
    const n = parseFloat(v);
    return Number.isFinite(n) ? n : null;
  }

  function calcBMI(weightKg, heightCm) {
    if (!weightKg || !heightCm) return null;
    const hM = heightCm / 100;
    if (hM <= 0) return null;
    return weightKg / (hM * hM);
  }

  function bmiCategory(bmi) {
    if (bmi == null) return "";
    if (bmi < 18.5) return "Underweight";
    if (bmi < 25) return "Normal";
    if (bmi < 30) return "Overweight";
    return "Obese";
  }

  function renderBMI() {
    const weight = toNum($("weightKg").value);
    const height = toNum($("heightCm").value);
    const bmi = calcBMI(weight, height);
    $("bmiValue").textContent = bmi ? bmi.toFixed(1) : "—";
    $("bmiNote").textContent = bmi ? `(${bmiCategory(bmi)})` : "";
  }

  function renderAll() {
    renderBMI();
  }

  $("calcBtn").addEventListener("click", renderAll);
  ["weightKg","heightCm"].forEach(id => $(id).addEventListener("input", renderAll));

  $("clearBtn").addEventListener("click", () => {
    ["weightKg","heightCm","waistCm","hipCm","age","rhr"].forEach(id => $(id).value = "");
    renderAll();
  });

  renderAll();
})();
</script>
{% endblock content %}